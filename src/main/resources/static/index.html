<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>User Management</title>
		<!--Bootstrap CSS-->
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
	</head>
	<body class="p-4">
		
		<div class="container">
			<h1 class="mb-4">User Management</h1>
			
			<!-- Add User Form -->
			<form id="addUserForm" class="mb-4">
				<div class="row g-2">
					<div class="col">
						<input type="text" id="firstName" placeholder="First Name" class="form-control" required>
					</div>
					<div class="col">
						<input type="text" id="lastName" placeholder="Last Name" class="form-control" required>
					</div>
					<div class="col">
						<input type="text" id="userName" placeholder="Username" class="form-control" required>
					</div>
					<div class="col">
						<input type="email" id="email" placeholder="Email" class="form-control" required>
					</div>
					<div class="col"">
						<button type="submit" class="btn btn-primary">Add User</button>
					</div>
				</div>
			</form>
			
			<!-- User Table -->
			<table class="table table-striped">
				<thead>
					<tr>
						<th>ID</th>
						<th>First Name</th>
						<th>Last Name</th>
						<th>Username</th>
						<th>Email</th>
						<th>Actions</th>
					</tr>
				</thead>
				<tbody id="userTableBody"></tbody>
			</table>
		</div>
		
		<!-- Bootstrap JS & Dependencies -->
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
		
		<script>
		//Base API URL
		
		const API_URL = 'http://localhost:8080/users';
		
		//Load users
		function loadUsers()
		{
			fetch(API_URL)
			.then(res => res.json())
			.then(users =>
			{
				console.log('Fetched users: ' , users);
				const tbody= document.getElementById('userTableBody');
				tbody.innerHTML = '';
				users.forEach(u =>
				{
					tbody.innerHTML += `
					<tr> 
						<td>${u.id}</td>
						<td>${u.firstName}</td>
						<td>${u.lastName}</td>
						<td>${u.userName || ''}</td>
						<td>${u.email}</td>
						<td>
							<button class="btn btn-sm btn-warning" onclick="editUser(${u.id})">Edit</button>
							<button class="btn btn-sm btn-danger" onclick="deleteUser(${u.id})">Delete</button>
						</td>
					</tr>
					`;
			 	});
			});
		
		}
		
		//Add new user
		document.getElementById('addUserForm').addEventListener('submit', function(e)
		{
			e.preventDefault();
			const user=
			{
				firstName: document.getElementById('firstName').value,
				lastName: document.getElementById('lastName').value,
				userName: document.getElementById('userName').value,
				email: document.getElementById('email').value
			};
			fetch(API_URL, 
			{
				method: 'POST',
				headers: { 'Content-Type': 'application/json'},
				body: JSON.stringify(user)
			}).then(() => 
			{
				this.reset();
				loadusers();
			});
		});
		
		
		//Delete User
		function deleteUser(id)
		{
			if(confirm('Are you sure you want to delete this user?'))
			{
				fetch(`${API_URL}/${id}`, { method: 'DELETE' })
				.then(() => loadUsers());
			}
		}
		
		//Edit User
		function editUser(id)
		{
			fetch(`${API_URL}/${id}`)
			.then(res => res.json())
			.then(u => 
			{
				const firstName = prompt('First Name: ', u.firstName);
				const lastName = prompt('Last Name:', u.lastName);
				const userName = prompt('Username: ', u.userName);
				const email = prompt('Email:', u.email);
				const updated = { firstName, lastName, userName, email };
				fetch(`${API_URL}/${id}`,
				{
					method: 'PUT',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify(updated)
				})
				.then(() => loadUsers());
			})
		}
		
		//Inital Load
		loadUsers();
		</script>
	</body>
</html>
					
	